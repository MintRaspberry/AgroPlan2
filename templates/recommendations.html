{% extends "base.html" %}

{% block title %}–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ - AgroPlan{% endblock %}

{% block extra_css %}
<style>
.recommendations-hero {
    background:
    radial-gradient(ellipse at 80% 20%, rgba(100, 255, 218, 0.2) 0%, transparent 50%),
    radial-gradient(ellipse at 20% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 50%),
    var(--gradient-premium);
    border-radius: var(--radius-3xl);
    padding: 80px 60px;
    margin-bottom: 60px;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-luxury);
    border: 1px solid rgba(100, 255, 218, 0.1);
}

.recommendations-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle fill="%2364ffda" opacity="0.05" cx="50" cy="50" r="2"/></svg>');
    animation: float 25s infinite linear;
}

.analysis-card {
    background: rgba(23, 42, 69, 0.7);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(100, 255, 218, 0.1);
    border-radius: var(--radius-2xl);
    padding: 50px;
    box-shadow: var(--shadow-elegant);
    margin-bottom: 60px;
    transition: all 0.4s var(--ease-smooth);
}

.analysis-card:hover {
    border-color: rgba(100, 255, 218, 0.2);
    box-shadow: var(--shadow-luxury);
}

.recommendation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 24px;
    margin: 40px 0;
}

.recommendation-card {
    background: rgba(23, 42, 69, 0.8);
    border: 1px solid;
    border-radius: var(--radius-xl);
    padding: 32px;
    transition: all 0.4s var(--ease-smooth);
    position: relative;
    overflow: hidden;
}

.recommendation-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: inherit;
    opacity: 0.6;
}

.recommendation-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-luxury);
}

.recommendation-success {
    border-color: rgba(100, 255, 218, 0.3);
}

.recommendation-success::before {
    background: var(--gradient-emerald);
}

.recommendation-warning {
    border-color: rgba(255, 215, 0, 0.3);
}

.recommendation-warning::before {
    background: var(--gradient-gold);
}

.recommendation-info {
    border-color: rgba(168, 178, 209, 0.3);
}

.recommendation-info::before {
    background: var(--light-slate);
}

.crop-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
}

.crop-family {
    font-size: 0.8rem;
    color: var(--light-slate);
    background: rgba(100, 255, 218, 0.1);
    padding: 4px 8px;
    border-radius: var(--radius-full);
}

.no-fields-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--light-slate);
}

.no-fields-message .icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    margin-bottom: 12px;
    font-weight: 600;
    color: var(--white);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.form-input, .form-select {
    width: 100%;
    padding: 16px 20px;
    border: 1px solid rgba(100, 255, 218, 0.2);
    border-radius: var(--radius-md);
    font-size: 1rem;
    transition: all 0.3s var(--ease-smooth);
    background: rgba(23, 42, 69, 0.8);
    color: var(--white);
    font-family: inherit;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: var(--emerald);
    box-shadow: 0 0 0 3px rgba(100, 255, 218, 0.1);
    background: rgba(23, 42, 69, 0.9);
}

.crops-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.crop-item {
    background: rgba(23, 42, 69, 0.6);
    padding: 15px;
    border-radius: var(--radius-lg);
    border: 1px solid rgba(100, 255, 218, 0.1);
    text-align: center;
    transition: all 0.3s var(--ease-smooth);
}

.crop-item:hover {
    border-color: rgba(100, 255, 218, 0.3);
    transform: translateY(-2px);
}

.crop-name {
    font-weight: 600;
    color: var(--white);
    margin-bottom: 5px;
}

.crop-family {
    font-size: 0.8rem;
    color: var(--light-slate);
}
</style>
{% endblock %}

{% block content %}
<!-- –ü—Ä–µ–º–∏—É–º –≥–µ—Ä–æ–π -->
<section class="recommendations-hero">
    <div class="container">
        <h1 class="hero-title">–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h1>
        <p class="hero-subtitle">
            –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–∏—Ö –ø–æ–ª–µ–π –∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–∞–¥–æ–∫
        </p>
    </div>
</section>

<!-- –ü—Ä–µ–º–∏—É–º —Ñ–æ—Ä–º–∞ –∞–Ω–∞–ª–∏–∑–∞ -->
<section class="analysis-card">
    <div class="container">
        <h2 class="section-title">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h2>

        {% if not fields %}
        <div class="no-fields-message">
            <div class="icon">üåæ</div>
            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª–µ–π</h3>
            <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ</p>
            <a href="/fields" class="btn btn-primary" style="margin-top: 20px;">
                üìç –ü–µ—Ä–µ–π—Ç–∏ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –ø–æ–ª–µ–π
            </a>
        </div>
        {% else %}
        <form method="post" action="/recommendations">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 40px;">
                <div class="form-group">
                    <label for="field_id" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</label>
                    <select id="field_id" name="field_id" required class="form-select">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ --</option>
                        {% for field in fields %}
                        <option value="{{ field.id }}" {% if selected_field_id == field.id %}selected{% endif %}>
                            {{ field.name }} ‚Ä¢ {{ "%.2f"|format(field.area) if field.area else '0' }} –≥–∞
                        </option>
                        {% endfor %}
                    </select>
                    {% if fields %}
                    <div style="margin-top: 10px; font-size: 0.9rem; color: var(--light-slate);">
                        –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ–ª–µ–π: {{ fields|length }}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="target_crop" class="form-label">–¶–µ–ª–µ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞</label>
                    <select id="target_crop" name="target_crop" required class="form-select">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É --</option>
                        {% for rule in crop_rules %}
                        <option value="{{ rule.crop }}" {% if target_crop == rule.crop %}selected{% endif %}>
                            {{ rule.crop }}
                        </option>
                        {% endfor %}
                    </select>
                    {% if crop_rules %}
                    <div style="margin-top: 10px; font-size: 0.9rem; color: var(--light-slate);">
                        –î–æ—Å—Ç—É–ø–Ω–æ –∫—É–ª—å—Ç—É—Ä: {{ crop_rules|length }}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div style="text-align: center;">
                <button type="submit" class="btn btn-primary btn-large">
                    <span style="font-size: 1.2em;">üîç</span>
                    <span>–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span>
                </button>
            </div>
        </form>
        {% endif %}
    </div>
</section>

<!-- –ü—Ä–µ–º–∏—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
{% if recommendations %}
<section class="analysis-card">
    <div class="container">
        <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
        <p style="text-align: center; color: var(--light-slate); margin-bottom: 48px; font-size: 1.1rem;">
            –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—è <strong style="color: var(--white);">"{{ selected_field_name }}"</strong>
            —Å –∫—É–ª—å—Ç—É—Ä–æ–π <strong style="color: var(--white);">"{{ target_crop }}"</strong>
        </p>

        <div class="recommendation-grid">
            {% for recommendation in recommendations %}
            <div class="recommendation-card recommendation-{{ recommendation.type }}">
                <div style="display: flex; align-items: flex-start; gap: 20px;">
                    <div style="font-size: 2rem; flex-shrink: 0;">
                        {% if recommendation.type == "success" %}‚úÖ
                        {% elif recommendation.type == "warning" %}‚ö†Ô∏è
                        {% elif recommendation.type == "info" %}‚ÑπÔ∏è
                        {% else %}üí°{% endif %}
                    </div>
                    <div style="flex: 1;">
                        <h3 style="color: var(--white); margin-bottom: 12px; font-size: 1.2rem; font-weight: 700;">
                            {{ recommendation.title }}
                        </h3>
                        <p style="color: var(--light-slate); line-height: 1.7; margin: 0;">
                            {{ recommendation.message }}
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä–∞—Ö -->
{% if crop_rules %}
<section class="analysis-card">
    <div class="container">
        <h2 class="section-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É–ª—å—Ç—É—Ä—ã</h2>
        <p style="text-align: center; color: var(--light-slate); margin-bottom: 32px;">
            –°–ø–∏—Å–æ–∫ –∫—É–ª—å—Ç—É—Ä, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        </p>

        <div class="crops-grid">
            {% for rule in crop_rules %}
            <div class="crop-item">
                <div class="crop-name">{{ rule.crop }}</div>
                {% if rule.family %}
                <div class="crop-family">{{ rule.family }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
<section>
    <div class="container">
        <div class="card" style="background: linear-gradient(135deg, rgba(255, 243, 205, 0.1), rgba(255, 234, 167, 0.1)); border: 1px solid rgba(255, 215, 0, 0.2);">
            <h3 style="text-align: center; margin-bottom: 16px;">‚ÑπÔ∏è –û —Å–∏—Å—Ç–µ–º–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</h3>
            <p style="text-align: center; color: var(--light-slate); margin-bottom: 16px;">
                –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–∞–¥–æ–∫ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ–ª–µ, —Ç–∏–ø –ø–æ—á–≤—ã, –ø–ª–æ—â–∞–¥—å –∏ —Å–µ–∑–æ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
                –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç—É.
            </p>
            <p style="text-align: center; color: var(--gold); font-weight: 600;">
                üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∞–≥—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç–∞ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã
                —Å —É—á–µ—Ç–æ–º –º–µ—Å—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Ö–æ–∑—è–π—Å—Ç–≤–∞.
            </p>
        </div>
    </div>
</section>
{% endblock %}